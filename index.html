<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>어떤 재료를 사용할까요?</title>
<style>
  :root{--bg:#f6f7f9;--card:#fff;--ink:#111;--muted:#6b7280;--accent:#4f46e5;--line:#e5e7eb}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif}
  .wrap{max-width:960px;margin:0 auto;padding:28px 16px}
  h1{margin:8px 0 20px;font-size:28px;text-align:center}
  .grid{display:grid;gap:20px}
  @media(min-width:900px){.grid{grid-template-columns:520px 1fr}}
  .card{background:var(--card);border-radius:18px;box-shadow:0 8px 24px rgba(0,0,0,.08)}
  .pad{padding:20px}

  .wheel-wrap{position:relative;aspect-ratio:1/1;width:100%}
  .pin{position:absolute;left:50%;transform:translateX(-50%);top:-4px;width:0;height:0;border-left:14px solid transparent;border-right:14px solid transparent;border-top:24px solid #f59e0b;filter:drop-shadow(0 2px 2px rgba(0,0,0,.25))}
  svg{width:100%;height:auto;display:block}

  .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px;justify-content:center}
  button{border:0;border-radius:12px;padding:10px 14px;font:inherit;cursor:pointer}
  .primary{background:var(--accent);color:#fff}
  .ghost{background:#eef2ff;color:#3730a3}
  .danger{background:#ef4444;color:#fff}

  .result{font-weight:800;font-size:24px;margin:14px 0 16px;text-align:center}
  .muted{color:var(--muted);font-size:13px}
  .soft-divider{height:1px;background:var(--line);margin:8px 0 14px}

  .inputs-title{margin:0 0 6px;font-size:18px}
  .inputs{display:flex;flex-direction:column;gap:8px;margin-top:10px}
  .input-row{display:flex;gap:8px}
  .input-row input{flex:1;border:1px solid var(--line);border-radius:10px;padding:10px 12px;font:inherit}
  .chipbox{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .chip{background:#eef2ff;color:#3730a3;border-radius:999px;padding:6px 10px;font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <h1>어떤 재료를 사용할까요?</h1>
  <div class="grid">
    <!-- Wheel -->
    <div class="card pad">
      <div class="wheel-wrap">
        <div class="pin"></div>
        <svg viewBox="-50 -50 100 100" aria-label="랜덤 돌림판">
          <g id="slices" style="transition:transform 5s cubic-bezier(.12,.2,0,1)"></g>
          <circle cx="0" cy="0" r="48" fill="none" stroke="#2e2e2e" stroke-width="1.5"></circle>
          <circle cx="0" cy="0" r="6" fill="#111"></circle>
        </svg>
      </div>

      <div class="row">
        <button id="spin" class="primary">돌리기</button>
        <button id="shuffle" class="ghost">색상 섞기</button>
        <button id="reset" class="ghost">처음 상태로</button>
      </div>

      <div id="result" class="result">선택된 재료가 여기에 표시됩니다</div>
      <!-- 요청: 선택된 재료와 입력영역 사이 구분선 -->
      <div class="soft-divider"></div>

      <p class="muted" style="text-align:center;margin-top:6px">입력칸을 수정하면 휠이 실시간으로 업데이트됩니다.</p>
    </div>

    <!-- Inputs -->
    <div class="card pad">
      <h2 class="inputs-title">재료 항목 입력</h2>
      <div class="inputs" id="inputs"></div>
      <div class="row">
        <button id="add" class="ghost">항목 추가</button>
        <button id="clear" class="danger">모두 삭제</button>
      </div>
      <div class="chipbox" id="chips"></div>
    </div>
  </div>
</div>

<script>
  // ===== 초기 항목: 입력창에 미리 들어가 있게 설정 (텍스트로 '기본항목:'은 표시하지 않음) =====
  const INITIAL_ITEMS = ["병뚜껑","종이","빨대"];
  let items = [...INITIAL_ITEMS];
  let hueSeed = Math.floor(Math.random()*360);

  // DOM
  const gSlices = document.getElementById('slices');
  const inputsBox = document.getElementById('inputs');
  const chipsBox  = document.getElementById('chips');
  const resultEl  = document.getElementById('result');

  // 유틸
  const makeColors = (n, seed=0) => Array.from({length:n}, (_,i)=>`hsl(${(seed + i*(360/n))%360} 80% 68%)`);
  const deg2rad = d => d*Math.PI/180;

  // ===== 부채꼴 휠 그리기 (정확히 n등분) =====
  function drawWheel(){
    const n = items.length || 1;
    const colors = makeColors(n, hueSeed);
    gSlices.innerHTML = '';
    const slice = 360/n;

    for(let i=0;i<n;i++){
      const start = i*slice-90, end=(i+1)*slice-90;   // 12시를 0도로 보정
      const x1 = 48*Math.cos(deg2rad(start)), y1 = 48*Math.sin(deg2rad(start));
      const x2 = 48*Math.cos(deg2rad(end)),   y2 = 48*Math.sin(deg2rad(end));
      const large = slice>180?1:0;

      const p = document.createElementNS('http://www.w3.org/2000/svg','path');
      p.setAttribute('d', `M0 0 L ${x1} ${y1} A 48 48 0 ${large} 1 ${x2} ${y2} Z`);
      p.setAttribute('fill', colors[i]);
      gSlices.appendChild(p);

      const mid = start + slice/2;
      const rx = 30*Math.cos(deg2rad(mid)), ry = 30*Math.sin(deg2rad(mid));
      const t = document.createElementNS('http://www.w3.org/2000/svg','text');
      t.setAttribute('x', rx); t.setAttribute('y', ry);
      t.setAttribute('text-anchor','middle');
      t.setAttribute('dominant-baseline','middle');
      t.setAttribute('font-size','4');
      t.setAttribute('fill','#111');
      const label = (items[i] ?? '').toString().trim() || '항목';
      t.textContent = label.length>9 ? label.slice(0,9)+'…' : label;
      gSlices.appendChild(t);
    }
  }

  // ===== 입력 UI =====
  function rowTemplate(value='', canRemove=true){
    const row = document.createElement('div');
    row.className = 'input-row';
    const input = document.createElement('input');
    input.type = 'text';
    input.placeholder = '예: 병뚜껑';
    input.value = value;
    const del = document.createElement('button');
    del.textContent = '삭제';
    del.className = 'danger';
    if(!canRemove){ del.disabled = true; del.style.opacity=.6; }
    row.appendChild(input); row.appendChild(del);

    // 실시간 반영
    input.addEventListener('input', syncFromInputs);
    // Enter로 추가
    input.addEventListener('keydown', e=>{ if(e.key==='Enter'){ addRow(); } });
    // 삭제
    del.addEventListener('click', ()=>{
      if(inputsBox.children.length<=1){ input.value=''; syncFromInputs(); return; }
      row.remove(); syncFromInputs();
    });
    return row;
  }

  function renderInputs(){
    inputsBox.innerHTML = '';
    (items.length? items : ['']).forEach(v=> inputsBox.appendChild(rowTemplate(v,true)));
    renderChips();
  }

  function collectItems(){
    return Array.from(inputsBox.querySelectorAll('input'))
      .map(i=>i.value.trim()).filter(Boolean);
  }

  function syncFromInputs(){
    items = collectItems();
    drawWheel();
    renderChips();
  }

  function renderChips(){
    chipsBox.innerHTML = '';
    items.forEach(s=>{
      const c = document.createElement('div'); c.className='chip'; c.textContent=s;
      chipsBox.appendChild(c);
    });
  }

  // ===== 액션 =====
  function addRow(value=''){
    inputsBox.appendChild(rowTemplate(value,true));
    inputsBox.lastChild.querySelector('input').focus();
  }

  document.getElementById('add').addEventListener('click', ()=> addRow());

  document.getElementById('clear').addEventListener('click', ()=>{
    inputsBox.innerHTML=''; items=[]; renderInputs(); drawWheel(); resultEl.textContent='항목을 입력해 주세요';
  });

  document.getElementById('reset').addEventListener('click', ()=>{
    items=[...INITIAL_ITEMS]; renderInputs(); drawWheel(); resultEl.textContent='처음 상태로 리셋되었습니다';
  });

  document.getElementById('shuffle').addEventListener('click', ()=>{
    hueSeed = Math.floor(Math.random()*360); drawWheel();
  });

  // 회전 & 결과
  document.getElementById('spin').addEventListener('click', ()=>{
    if(!items.length){ alert('항목을 1개 이상 입력해 주세요.'); return; }
    const n = items.length, slice = 360/n;
    const spins = 5 + Math.random()*3;
    const offset = Math.random()*360;
    const deg = spins*360 + offset;

    gSlices.style.transform = `rotate(${deg}deg)`;

    const normalized = (deg % 360 + 360) % 360;   // 0~359
    const fromTop = (normalized) % 360;           // 핀은 12시 방향
    const index = Math.floor(((360 - fromTop) % 360) / slice) % n;
    const pick = items[index];

    setTimeout(()=>{ resultEl.textContent = `선택된 재료: ${pick}`; }, 5000);
  });

  // ===== 초기화 =====
  (function init(){
    renderInputs();
    drawWheel();
  })();
</script>
</body>
</html>
