<!-- SVG 구조 예시 -->
<svg viewBox="-50 -50 100 100" aria-label="랜덤 돌림판">
  <g id="slices" style="transition:transform 5s cubic-bezier(.12,.2,0,1)"></g>
  <g id="labels" style="transition:transform 5s cubic-bezier(.12,.2,0,1)"></g>
</svg>

<script>
// 필수: 전역 참조들
const PASTELS = ['#D9ECFF','#FFE4EA','#FFF6C9','#DDF8EA','#E9D8FD','#FFE8CC'];
const deg2rad = d => d * Math.PI / 180;

const gSlices = document.getElementById('slices');
const gLabels = document.getElementById('labels');

// 항목 배열 (비어있어도 최소 1로 처리됨)
let items = Array.isArray(window.items) ? window.items : ["병뚜껑","종이","빨대"];

function drawWheel(){
  const nRaw = items.length;
  const n = nRaw > 0 ? nRaw : 1;         // 0 방지
  gSlices.innerHTML = '';
  gLabels.innerHTML = '';
  const slice = 360 / n;

  for (let i = 0; i < n; i++){
    const start = i*slice - 90;
    const end   = (i+1)*slice - 90;
    const x1 = 48*Math.cos(deg2rad(start)), y1 = 48*Math.sin(deg2rad(start));
    const x2 = 48*Math.cos(deg2rad(end)),   y2 = 48*Math.sin(deg2rad(end));
    const large = slice > 180 ? 1 : 0;

    // 조각
    const p = document.createElementNS('http://www.w3.org/2000/svg','path');
    p.setAttribute('d', `M0 0 L ${x1} ${y1} A 48 48 0 ${large} 1 ${x2} ${y2} Z`);
    p.setAttribute('fill', PASTELS[i % PASTELS.length]);
    gSlices.appendChild(p);

    // 라벨: 중앙각 기준 배치 + 아래쪽이면 180° 뒤집기
    const mid = start + slice/2;
    const rLabel = 28;
    const rx = rLabel*Math.cos(deg2rad(mid));
    const ry = rLabel*Math.sin(deg2rad(mid));
    let angle = mid;
    const norm = (angle % 360 + 360) % 360;
    if (norm > 90 && norm < 270) angle += 180;

    const t = document.createElementNS('http://www.w3.org/2000/svg','text');
    t.setAttribute('x', rx);
    t.setAttribute('y', ry);
    t.setAttribute('text-anchor','middle');
    t.setAttribute('dominant-baseline','middle');
    t.setAttribute('font-size','6');
    t.setAttribute('font-weight','700');
    t.setAttribute('fill', '#111');
    t.setAttribute('transform', `rotate(${angle} ${rx} ${ry})`);

    const label = (items[i] ?? '').toString().trim() || '항목';
    t.textContent = label.length > 6 ? label.slice(0,6)+'…' : label;
    gLabels.appendChild(t);
  }
}

// DOM이 준비된 뒤 실행 (스크립트를 맨 아래에 두면 생략 가능)
if (document.readyState === 'loading') {
  document.addEventListener('DOMContentLoaded', drawWheel);
} else {
  drawWheel();
}
</script>
